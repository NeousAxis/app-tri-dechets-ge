<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eco Tri - Genève zéro déchet 2025</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.4;
            margin: 0;
            padding: 10px;
            background-color: #f0f0f0;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        #recherche {
            width: calc(100% - 22px);
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        #resultats {
            background-color: white;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        #carte {
            height: 300px;
            margin-top: 10px;
            border-radius: 4px;
            overflow: hidden;
        }
        .boutons {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        button {
            padding: 8px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }
        button:hover {
            background-color: #2980b9;
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
</head>
<body>
    <h1>Eco Tri - Objectif : Genève zéro déchet à l'horizon 2025.<br>Votre participation est essentielle !</h1>
    <input type="text" id="recherche" placeholder="Entrez un type de déchet...">
    <div class="boutons">
        <button onclick="trouverPointsProches()">Points de collecte proches</button>
        <button onclick="afficherTousLesPoints()">Tous les points de collecte</button>
    </div>
    <div id="resultats"></div>
    <div id="carte"></div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        const pointsDeCollecte = [
            {
                nom: "Écopoint Central",
                lat: 46.2044,
                lon: 6.1432,
                types: ["Papier", "Carton", "Verre", "PET", "Aluminium", "Fer-blanc", "Piles", "Textiles", "Capsules de café"]
            },
            {
                nom: "Déchetterie Municipale",
                lat: 46.1984,
                lon: 6.1692,
                types: ["Déchets encombrants", "Déchets électroniques", "Déchets de jardin", "Huiles usagées", "Bois", "Métaux", "Gravats", "Pneus"]
            },
            {
                nom: "Point de Recyclage Quartier",
                lat: 46.2104,
                lon: 6.1501,
                types: ["Papier", "Verre", "PET", "Aluminium", "Piles"]
            },
            {
                nom: "Centre de Tri Spécialisé",
                lat: 46.1900,
                lon: 6.1380,
                types: ["Déchets spéciaux", "Produits chimiques", "Médicaments périmés", "Batteries", "Cartouches d'encre"]
            }
        ];

        const categoriesSpeciales = {
            "Ordures ménagères": ["Mouchoirs usagés", "Litière pour chat", "Couches", "Emballages souillés"],
            "Compost": ["Épluchures de fruits et légumes", "Marc de café", "Sachets de thé"],
            "Déchets électroniques": ["Téléphones", "Ordinateurs", "Tablettes", "Électroménager"],
            "Déchets spéciaux": ["Peintures", "Solvants", "Pesticides", "Ampoules fluorescentes"],
            "Recyclables": ["Bouteilles en plastique", "Boîtes de conserve", "Journaux", "Magazines"]
        };

        let map = L.map('carte').setView([46.2044, 6.1432], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        let markers = [];

        function afficherPoints(points) {
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
            points.forEach(point => {
                let marker = L.marker([point.lat, point.lon])
                    .addTo(map)
                    .bindPopup(`<b>${point.nom}</b><br>Types de déchets: ${point.types.join(', ')}`);
                markers.push(marker);
            });
            if (points.length > 0) {
                map.fitBounds(L.featureGroup(markers).getBounds().pad(0.1));
            }
        }

        function rechercher() {
            const recherche = document.getElementById('recherche').value.toLowerCase();
            const resultats = document.getElementById('resultats');
            resultats.innerHTML = '';

            let trouves = pointsDeCollecte.filter(point => 
                point.types.some(type => type.toLowerCase().includes(recherche))
            );

            if (trouves.length === 0) {
                for (let categorie in categoriesSpeciales) {
                    if (categoriesSpeciales[categorie].some(item => item.toLowerCase().includes(recherche))) {
                        resultats.innerHTML = `<p>"${recherche}" fait partie de la catégorie ${categorie}.</p>`;
                        return;
                    }
                }
            }

            if (trouves.length > 0) {
                trouves.forEach(point => {
                    resultats.innerHTML += `<p><strong>${point.nom}</strong> - Types de déchets acceptés: ${point.types.join(', ')}</p>`;
                });
                afficherPoints(trouves);
            } else {
                resultats.innerHTML = `<p>Aucun résultat spécifique trouvé pour "${recherche}". Veuillez vérifier l'orthographe ou essayer un terme plus général. Pour les déchets non listés, ils vont généralement dans les ordures ménagères, mais vérifiez auprès des autorités locales pour des instructions spécifiques.</p>`;
            }
        }

        function trouverPointsProches() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    let lat = position.coords.latitude;
                    let lon = position.coords.longitude;
                    let pointsProches = pointsDeCollecte.sort((a, b) => {
                        let distA = distance(lat, lon, a.lat, a.lon);
                        let distB = distance(lat, lon, b.lat, b.lon);
                        return distA - distB;
                    }).slice(0, 3);  // Prend les 3 points les plus proches

                    afficherPoints(pointsProches);
                    
                    let resultats = document.getElementById('resultats');
                    resultats.innerHTML = "<h3>Points de collecte les plus proches :</h3>";
                    pointsProches.forEach(point => {
                        let dist = distance(lat, lon, point.lat, point.lon).toFixed(2);
                        resultats.innerHTML += `<p><strong>${point.nom}</strong> - Distance: ${dist} km<br>Types de déchets: ${point.types.join(', ')}</p>`;
                    });
                }, function(error) {
                    alert("Erreur de géolocalisation : " + error.message);
                });
            } else {
                alert("La géolocalisation n'est pas supportée par votre navigateur.");
            }
        }

        function distance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Rayon de la Terre en km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function afficherTousLesPoints() {
            afficherPoints(pointsDeCollecte);
            let resultats = document.getElementById('resultats');
            resultats.innerHTML = "<h3>Tous les points de collecte :</h3>";
            pointsDeCollecte.forEach(point => {
                resultats.innerHTML += `<p><strong>${point.nom}</strong><br>Types de déchets: ${point.types.join(', ')}</p>`;
            });
        }

        document.getElementById('recherche').addEventListener('input', rechercher);
    </script>
</body>
</html>
