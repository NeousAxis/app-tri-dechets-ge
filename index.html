<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eco Tri - Genève zéro déchet 2025</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.4;
            margin: 0;
            padding: 10px;
            background-color: #f0f0f0;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        #recherche-container {
            display: flex;
            margin-bottom: 10px;
        }
        #recherche {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
        }
        #chercher {
            padding: 8px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        #resultats {
            background-color: white;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        #carte {
            height: 300px;
            margin-top: 10px;
            border-radius: 4px;
            overflow: hidden;
        }
        .boutons {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }
        button {
            padding: 8px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }
        button:hover {
            background-color: #2980b9;
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
</head>
<body>
    <h1>Eco Tri - Objectif : Genève zéro déchet à l'horizon 2025.<br>Votre participation est essentielle !</h1>
    <div id="recherche-container">
        <input type="text" id="recherche" placeholder="Entrez un type de déchet...">
        <button id="chercher" onclick="rechercher()">Chercher</button>
    </div>
    <div class="boutons">
        <button onclick="trouverPointsProches()">Points de collecte proches</button>
    </div>
    <div id="resultats"></div>
    <div id="carte"></div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        const pointsDeCollecte = [
            {
                nom: "Écopoint Central",
                lat: 46.2044,
                lon: 6.1432,
                types: ["Papier", "Carton", "Verre", "PET", "Aluminium", "Fer-blanc", "Piles", "Textiles", "Capsules de café"]
            },
            {
                nom: "Déchetterie Municipale",
                lat: 46.1984,
                lon: 6.1692,
                types: ["Déchets encombrants", "Déchets électroniques", "Déchets de jardin", "Huiles usagées", "Bois", "Métaux", "Gravats", "Pneus"]
            },
            {
                nom: "Point de Recyclage Quartier",
                lat: 46.2104,
                lon: 6.1501,
                types: ["Papier", "Verre", "PET", "Aluminium", "Piles"]
            },
            {
                nom: "Centre de Tri Spécialisé",
                lat: 46.1900,
                lon: 6.1380,
                types: ["Déchets spéciaux", "Produits chimiques", "Médicaments périmés", "Batteries", "Cartouches d'encre"]
            }
        ];

        const baseDeDonneesDechets = {
            "papier": {
                categorie: "Recyclables",
                poubelle: "Poubelle bleue ou conteneur bleu",
                instructions: "Déposez le papier dans la poubelle bleue ou le conteneur bleu. Assurez-vous qu'il soit propre et sec."
            },
            "carton": {
                categorie: "Recyclables",
                poubelle: "Poubelle bleue ou conteneur bleu",
                instructions: "Pliez les cartons et déposez-les dans la poubelle bleue ou le conteneur bleu."
            },
            "verre": {
                categorie: "Recyclables",
                poubelle: "Conteneur vert",
                instructions: "Déposez les bouteilles et bocaux en verre dans le conteneur vert. Retirez les bouchons et couvercles."
            },
            "plastique": {
                categorie: "Recyclables",
                poubelle: "Conteneur jaune",
                instructions: "Déposez les emballages plastiques dans le conteneur jaune. Rincez-les avant de les jeter."
            },
            "terreau": {
                categorie: "Déchets verts",
                poubelle: "Bac à compost, collecte des déchets verts ou déchetterie",
                instructions: "Le terreau usagé peut être composté, placé dans la collecte des déchets verts, apporté à la déchetterie ou réutilisé pour d'autres plantes."
            },          
            "organique": {
                categorie: "Compostable",
                poubelle: "Poubelle verte ou composteur",
                instructions: "Déposez les déchets organiques dans la poubelle verte ou dans votre composteur personnel."
            },
            "pile": {
                categorie: "Déchets spéciaux",
                poubelle: "Points de collecte spécifiques",
                instructions: "Rapportez les piles usagées dans les points de collecte en magasin ou en déchetterie."
            },
            "électronique": {
                categorie: "Déchets spéciaux",
                poubelle: "Points de collecte spécifiques",
                instructions: "Rapportez les appareils électroniques dans les points de collecte en magasin ou en déchetterie."
            },
            "médicament": {
                categorie: "Déchets spéciaux",
                poubelle: "Pharmacie",
                instructions: "Rapportez les médicaments périmés ou non utilisés à votre pharmacie."
            },
            "textile": {
                categorie: "Recyclables",
                poubelle: "Points de collecte spécifiques",
                instructions: "Déposez les textiles en bon état dans les conteneurs de collecte prévus à cet effet."
            },
            "huile": {
                categorie: "Déchets spéciaux",
                poubelle: "Points de collecte spécifiques",
                instructions: "Rapportez les huiles usagées en déchetterie. Ne les jetez jamais dans l'évier ou les toilettes."
            },
            "ampoule": {
                categorie: "Déchets spéciaux",
                poubelle: "Points de collecte spécifiques",
                instructions: "Rapportez les ampoules dans les points de collecte en magasin ou en déchetterie."
            },
            "bouchon liège": {
                categorie: "Recyclables",
                poubelle: "Points de collecte spécifiques",
                instructions: "Certains points de collecte acceptent les bouchons de liège pour le recyclage. Sinon, jetez-les dans les ordures ménagères (poubelle noire)."
            }
        };

        let map = L.map('carte').setView([46.2044, 6.1432], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        let markers = [];

        function afficherPoints(points) {
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
            points.forEach(point => {
                let marker = L.marker([point.lat, point.lon])
                    .addTo(map)
                    .bindPopup(`<b>${point.nom}</b><br>Types de déchets: ${point.types.join(', ')}`);
                markers.push(marker);
            });
            if (points.length > 0) {
                map.fitBounds(L.featureGroup(markers).getBounds().pad(0.1));
            }
        }

        function rechercher() {
            const recherche = document.getElementById('recherche').value.toLowerCase();
            const resultats = document.getElementById('resultats');
            resultats.innerHTML = '';

            let infoTrouvee = false;

            for (let dechet in baseDeDonneesDechets) {
                if (recherche.includes(dechet)) {
                    const info = baseDeDonneesDechets[dechet];
                    resultats.innerHTML += `
                        <p><strong>${dechet.charAt(0).toUpperCase() + dechet.slice(1)}</strong></p>
                        <p>Catégorie: ${info.categorie}</p>
                        <p>Poubelle: ${info.poubelle}</p>
                        <p>Instructions: ${info.instructions}</p>
                    `;
                    infoTrouvee = true;
                    break;
                }
            }

            if (!infoTrouvee) {
                let trouves = pointsDeCollecte.filter(point => 
                    point.types.some(type => type.toLowerCase().includes(recherche))
                );

                if (trouves.length > 0) {
                    resultats.innerHTML = "<h3>Points de collecte correspondants :</h3>";
                    trouves.forEach(point => {
                        resultats.innerHTML += `<p><strong>${point.nom}</strong> - Types de déchets acceptés: ${point.types.join(', ')}</p>`;
                    });
                    afficherPoints(trouves);
                } else {
                    resultats.innerHTML = `<p>Aucune information spécifique trouvée pour "${recherche}". Pour les déchets non listés, ils vont généralement dans les ordures ménagères (poubelle noire). Vérifiez auprès des autorités locales pour des instructions spécifiques sur le site web officiel de la ville de Genève : <a href="https://www.geneve.ch/fr/themes/proprete-voirie-dechets" target="_blank">https://www.geneve.ch/fr/themes/proprete-voirie-dechets</a></p>`;
                }
            }
        }

        function trouverPointsProches() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    let lat = position.coords.latitude;
                    let lon = position.coords.longitude;
                    let pointsProches = pointsDeCollecte.sort((a, b) => {
                        let distA = distance(lat, lon, a.lat, a.lon);
                        let distB = distance(lat, lon, b.lat, b.lon);
                        return distA - distB;
                    }).slice(0, 3);  // Prend les 3 points les plus proches

                    afficherPoints(pointsProches);
                    
                    let resultats = document.getElementById('resultats');
                    resultats.innerHTML = "<h3>Points de collecte les plus proches :</h3>";
                    pointsProches.forEach(point => {
                        let dist = distance(lat, lon, point.lat, point.lon).toFixed(2);
                        resultats.innerHTML += `<p><strong>${point.nom}</strong> - Distance: ${dist} km<br>Types de déchets: ${point.types.join(', ')}</p>`;
                    });
                }, function(error) {
                    alert("Erreur de géolocalisation : " + error.message);
                });
            } else {
                alert("La géolocalisation n'est pas supportée par votre navigateur.");
            }
        }

        function distance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Rayon de la Terre en km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Afficher tous les points de collecte par défaut
        afficherPoints(pointsDeCollecte);

        // Ajouter l'événement pour la touche Enter
        document.getElementById('recherche').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                rechercher();
            }
        });
    </script>
</body>
</html>
